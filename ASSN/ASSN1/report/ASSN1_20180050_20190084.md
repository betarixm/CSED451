Assignment #1: 2D Drawing
===
CSED451 Computer Graphics (Spring 2021) Assignment #1

`콤퓨타화상처리`
**최은수** (컴퓨터공학과, 20180050, ches7283)
**권민재** (컴퓨터공학과, 20190084, mzg00)


# 개요
OpenGL을 활용하여 "Firi Games"의 "Phoenix 2(2016)"에 기반한 슈팅게임 구현
### 적
- 5개의 서로다른 색깔의 적 등장하고 일정 시간마다 총알 발사와 무작위 이동
### 플레이어 
- 상하좌우 이동 가능하며 총알을 발사하여 적을 모두 제거하면 승리한다.
- mode 변경을 통해 (올 패스 / 올 페일) 모드 선택 가능하다.

![](https://i.imgur.com/D39QemX.png)



# 프로그래밍 환경
### 개발 환경
- Visual Studio 2019
### 라이브러리 버전
- OpenGL 4.1
- freeglut 3.2.1
- glew 2.2.0
- glm 0.9.9.9


# 프로그램 설계 및구현
## Class 
### 1. Game
- game mode (all-pass / all-fail) 변경 및 관리
- Player & Enemy instance 생성 및 삭제와 관리
- Infomation display
- Game over/win 체크 후 해당 루틴 실행

### 2. Shape
![](https://i.imgur.com/Lk39Qcr.png)

### 3. Ship
![](https://i.imgur.com/QZmRWV3.png)
(1) Player::keyboard_handler
- Switch case 문을 이용하여 OpenGL keyboard handler로 부터 넘어온 정보를 활용하여 구현하였다.
- **상하좌우키** : window 밖을 넘어가는지 체크 한 후 triangle->move를 사용하여 이동
- **space_bar** : shot 함수를 호출하여 Bullet 생성 후 리턴

(2) Hit check
- 총알이 우주선에 충돌하였는지 체크하는 루틴.
- 총알은 사각형이므로 네 점중 하나라도 우주선(삼각형) 내부에 존재하면 충돌로 간주한다.
- 삼각형의 한 점 T와 총알의 점 K가 삼각형의 나머지 두 점 A, B로 이루어진 직선너머 같은 쪽에 있는지를 모든 점에 대해 체크한다.
- f(x,y) = (x-x1)*(y1-y2) - (y-y1)*(x1-x2) 에서 f(T)xf(K) > 0인지 삼각형의 모든 점에 대해 체크한다.
- Enemy / Player의 경우 Mode에 따라 목숨을 잃고, 아니고가 다르므로 각 class마다 method 정의가 조금 다르다.


## Callback function
### 1. keyboard input handling
- **glutKeyboardFunc**와 **glutSpecialFunc** 사용
- 콜백함수 내부에서 모두 switch case 문을 사용하여 핸들링.
- Special : space_bar 입력에 대해 Player의 shot(총알발사) 함수 실행
- keyboard : c, f 는 모드 변경, 상하좌우 키는 Player의 move 함수 실행

### 2. TimerFunc
(1) BulletMoveHit
- 0.3초마다 실행되며, enemy와 player가 쏜 bullet들을 일정 단위길이만큼씩 이동시킨다.
- 이동시킨 bullet이 window밖을 나갈 경우 삭제한다.
- 각 bullet들이 Enemy와 Player에 충돌했는지 체크하고 충돌한 bullet은 삭제한다.

(2) BulletEnemyShot
- 3초마다 실행되며, enemy의 randomMove가 호출되며 좌/우/제자리 중 하나의 랜덤한 움직임을 한다.
- param value로 (value+1)%7을 넘겨줌으로써 움직임 7번 중 1번씩 bullet을 발사한다.



# 프로그램 실행 방법
### (1) 우주선 이동
- 키보드의 **상하좌우** 키를 누르면 그에 따라 우주선이 상하좌우로 이동한다. 
- 우주선은 선체의 일부분도 window 밖으로 나갈 수 없으며 적이 있는 위치까지 제한없이 이동 가능하다.

### (2) 총알 발사
- 키보드의 **space bar** 를 누르면 삼각형의 위쪽 꼭짓점을 통해 총알을 발사할 수 있다.
- 발사 가능한 총알 개수에는 제한이 없으며 이동과 동시에 총알 발사도 가능하다.

### (3) 모드 변경
- **C** : 키보드의 'c' 키를 누르면 올패스 모드로 전환된다. 
- **F** : 키보드의 'f' 키를 누르면 올패일 모드로 전환된다.
모드 변경 키가 한 번 더 눌릴경우 다시 노말모드로 변경된다. 
해당 모드는 모두 화면에 표시되므로 시각적으로 확인할 수 있다.


# 예제
실행 시작 : Normal mode, enemy 목숨1, player 목숨3\
score board : 좌측상단에서 enemy/player 남은 목숨과 총 갯수, Mode를 확인할 수 있다.
![](https://i.imgur.com/8u4R1cp.png =x300)

이동 : 상하좌우 키보드 입력을 통해 이동
enemy : 총 5마리로 뒤에 나올 때마다 목숨이 +1 더 많으며 각각 모두 색이 다르다.
player : 목숨이 한개씩 닳때마다 색깔이 변한다.
![](https://i.imgur.com/wsVQvPP.png =x300)

mode 변경 : all pass / all fail 모드에 따라 좌측상단에서 확인 가능.
![](https://i.imgur.com/6NUraWM.png =x300)

win : 적을 모두 제거할 경우 승리
Game over : 3개의 목숨을 모두 잃을 경우 패배.
![](https://i.imgur.com/mDWmoYt.png =x300)


# 토론
### call back 함수인자
- 해당 어싸인에서 본 팀은 구현을 위해 openGL의 여러 콜백함수 (glTimerfunc, glDisplay, keyboard 등) 를 사용하였다.
- openGL내부 콜백함수들은 외부에 선언되어있는 값들을 인자로 넘겨받을 수 없기 때문에 함수 내에서 우주선, 총알 등의 instance 들을 사용할 수 있는 방법에 대해 많은 고민을 하였다.
- 처음에는 JavaScript처럼 lamda 함수 리턴 을 활용하고자 하였지만 생각했던 데로 잘 구현되지 않아 외부에 static Global로 선언하여 활용하였다.
- 후에는 싱글턴방식을 차용하여 global 변수를 좀 더 객체지향적으로 포장하여 사용할 수 있을 것 같다.

### vertex 이동
- 해당 어싸인에서는 Graphics 수업 ppt를 참고하여 우주선의 내심(x,y)값에 +-1을 해주며 이동을 시켰다.
- 하지만 후에 수업에서 배운 transformation matrix를 활용하여 이동 시에 transition 함수를 호출하고, 각 vertex 값이 정확히 필요할 때 model view matrix에 직접 연산하여 vertex 값을 구한면 더 좋을 것 같다.

# 추가 구현
## 상태 텍스트 출력
## 멀티 키 입력


# 결론
1. OpenGL gl* 함수들을 통해 vertex 생성과 색깔 변경, view point등의 활용을 익힐 수 있었다.
2. GLUT 를 이용하여 **Window 생성**, **Keyboard 입력 이벤트 핸들링**, **타이머 기능** 등의 활용을 익힐 수 있었다.
3. 추가구현을 포함하여 멀티키 입력까지 적용하는 성공적인 슈팅게임을 완성하였다. 


# 개선 방향
### 우주선 회전 추가
- 충돌 체크와 총알 발사를 하는 함수에서 우주선의 각 vertex를 구할 때 rotate된 각도도 고려하여 계산한다.
- 그래서 현재는 우주선이 상하좌우로만 이동하는데 특수한 아이템 획득 또는 키보드 입력을 통해 내심을 중심으로 회전할 수 있도록 추가하면 좋을 것 같다.
- 또한 총알이 나가는 꼭짓점은 항상 고정이기 때문에 회전하면 총알의 이동도 그에 따라 방향/각도가 달라져서 훨씬 게임의 난이도가 상승할 것이다.
 
 
# 참고문헌
- OpenGL Docs (https://www.khronos.org/opengl/)